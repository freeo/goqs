apiVersion: skaffold/v1beta2
# apiVersion: skaffold/v1beta11
kind: Config
build:
  artifacts:
  - image: dev-infra-240819/goqs
    context: .
    docker: {}
  tagPolicy:
    envTemplate:
      # template: '{{.DOCKER_REGISTRY}}/{{.IMAGE_NAME}}:{{.VERSION}}'
      # relevant for `skaffold dev`
      template: 'eu.gcr.io/{{.IMAGE_NAME}}:skaffold'
  local: {}
deploy:
  kubectl: {}
profiles:
- name: dev
  build:
    tagPolicy:
      envTemplate:
        # template: '{{.DOCKER_REGISTRY}}/{{.IMAGE_NAME}}:{{.DIGEST_HEX}}'
        template: 'eu.gcr.io/{{.IMAGE_NAME}}:skaffold'
    local: {}
  deploy:
    helm:
      releases:
      - name: goqs
        chartPath: charts/goqs
        setValueTemplates:
          image.repository: '{{.DOCKER_REGISTRY}}/{{.IMAGE_NAME}}'
          # image.tag: '{{.DIGEST_HEX}}'
          image.tag: 'skaffold'
